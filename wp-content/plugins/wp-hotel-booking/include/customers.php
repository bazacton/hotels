<?php/** *  File Type: Customers Class */if( ! class_exists('cs_customers_options') ) {	    class cs_customers_options {				public function __construct() {						add_action('wp_ajax_customer_fields_save', array(&$this, 'customer_fields_save'));			add_action('wp_ajax_cs_add_customer', array(&$this, 'cs_add_customer'));					}				// add submenu page		public function cs_customers_settings() {						add_submenu_page('edit.php?post_type=rooms', __('Customers', 'booking'), __('Customers', 'booking'), 'manage_options', 'cs_customers', array(&$this, 'cs_customers_area'));		}				// customers fields		public function cs_customers_area() {						wp_hotel_booking::cs_data_table_style_script();						$cs_cstmr_data = get_option( "cs_customer_options" );						$cs_html = '			<div class="theme-wrap fullwidth">				<div class="outerwrapp-layer">					<div class="loading_div"> <i class="icon-circle-o-notch icon-spin"></i> <br>						' . __('Saving customers...', 'booking') . '					</div>					<div class="form-msg"> <i class="icon-check-circle-o"></i>						<div class="innermsg"></div>					</div>				</div>				<div class="row">					<form name="cs-booking-customers" id="cs-booking-customers" data-url="'.esc_js(admin_url('admin-ajax.php')).'" method="post">						<div class="cs-customers-area">							<script type="text/javascript">							jQuery(document).ready(function() {								jQuery("#cs_custmr_data").DataTable({									fnDrawCallback : function() {										cs_remove_customer();								  	}								});								cs_remove_customer();							});							</script>							<div class="cs-title"><h2>' . __('Customers', 'booking') . '</h2></div>	                        <a href="javascript:cs_createpop(\'cs_customer_pop\',\'filter\')" style="margin-top:20px;" class="button">'.__("+ Add New Customers","booking").'</a>						<div class="cs_table_data cs_loading">								<table id="cs_custmr_data" class="display" cellspacing="0" width="100%">									<thead>										<tr>											<th>' . __('First Name', 'booking') . '</th>											<th>' . __('Last Name', 'booking') . '</th>											<th>' . __('User', 'booking') . '</th>											<th>' . __('Telephone', 'booking') . '</th>											<th>' . __('Email', 'booking') . '</th>											<th>' . __('Address', 'booking') . '</th>											<th>' . __('City', 'booking') . '</th>											<th>' . __('Country', 'booking') . '</th>											<th>' . __('Actions', 'booking') . '</th>										</tr>									</thead>									<tfoot>										<tr>											<th>' . __('First Name', 'booking') . '</th>											<th>' . __('Last Name', 'booking') . '</th>											<th>' . __('User', 'booking') . '</th>											<th>' . __('Telephone', 'booking') . '</th>											<th>' . __('Email', 'booking') . '</th>											<th>' . __('Address', 'booking') . '</th>											<th>' . __('City', 'booking') . '</th>											<th>' . __('Country', 'booking') . '</th>											<th>' . __('Actions', 'booking') . '</th>										</tr>									</tfoot>									<tbody>';										$cs_cstmr_counter = 0;										if( is_array($cs_cstmr_data) && sizeof($cs_cstmr_data) > 0 ) {											foreach( $cs_cstmr_data as $key => $cstmr ) {																																			if( isset($cs_cstmr_data[$key]) ) {													$cs_cstmr_fields = $cs_cstmr_data[$key];												}												if( isset($cs_cstmr_fields) ) {													$params	= array();													$params['cs_cstmr_id'] = isset($cs_cstmr_fields['cus_id']) ? $cs_cstmr_fields['cus_id'] : '';													$params['cs_cstmr_name']   = isset($cs_cstmr_fields['cus_name']) ? $cs_cstmr_fields['cus_name'] : '';													$params['cs_cstmr_fname']  = isset($cs_cstmr_fields['cus_f_name']) ? $cs_cstmr_fields['cus_f_name'] : '';													$params['cs_cstmr_lname']  = isset($cs_cstmr_fields['cus_l_name']) ? $cs_cstmr_fields['cus_l_name'] : '';													$params['cs_cstmr_phone']  = isset($cs_cstmr_fields['cus_phone_no']) ? $cs_cstmr_fields['cus_phone_no'] : '';													$params['cs_cstmr_email']  = isset($cs_cstmr_fields['cus_email']) ? $cs_cstmr_fields['cus_email'] : '';													$params['cs_cstmr_adres']  = isset($cs_cstmr_fields['cus_address']) ? $cs_cstmr_fields['cus_address'] : '';													$params['cs_cstmr_city']   = isset($cs_cstmr_fields['cus_city']) ? $cs_cstmr_fields['cus_city'] : '';													$params['cs_cstmr_county'] = isset($cs_cstmr_fields['cus_country']) ? $cs_cstmr_fields['cus_country'] : '';													$cs_html .= '													<tr id="update-customers">														<td class="cs_customer_first_name">'.$this->customer_val_show( $params['cs_cstmr_fname'] ).'</td>														<td class="cs_customer_last_name">'.$this->customer_val_show( $params['cs_cstmr_lname'] ).'</td>														<td class="cs_customer_name">';																												$cs_user_data = get_user_by('id', $params['cs_cstmr_name']);																												$cs_user_name = is_object($cs_user_data) ? $cs_user_data->display_name : '';														$cs_html .= 														$this->customer_val_show( $cs_user_name ).'														</td>														<td class="cs_customer_phone">'.$this->customer_val_show( $params['cs_cstmr_phone'] ).'</td>														<td class="cs_customer_email">'.$this->customer_val_show( $params['cs_cstmr_email'] ).'</td>														<td class="cs_customer_address">'.$this->customer_val_show( $params['cs_cstmr_adres'] ).'</td>														<td class="cs_customer_city">'.$this->customer_val_show( $params['cs_cstmr_city'] ).'</td>														<td class="cs_customer_country">'.$this->customer_val_show( $params['cs_cstmr_county'] ).'</td>														<td>															<a class="remove-custmr" href="javascript:;" title="delete"><i class="icon-trash4"></i></a>															<a href="javascript:cs_createpop(\'cs_customer_pop_'.$cs_cstmr_counter.'\',\'filter\')"><i class="icon-pencil3"></i></a>															'.$this->cs_customer_edit($cs_cstmr_counter,$params).'														</td>													</tr>';												}												else {													$cs_html .= '<tr><td class="dataTables_empty" valign="top" colspan="7">' . __('No records found.', 'booking') . '</td></tr>';												}												$cs_cstmr_counter++;											}										}									$cs_html .= '										</tbody>								</table>							</div>						</div>					</form>				</div>			</div>';			echo force_balance_tags( $cs_html, true );			$this->cs_add_customer_form();		}				/**		 *		 *@Edit Customer		 *		 */		public function cs_customer_edit( $counter='',$params = array() ){			global $post;			$cs_html  = '';			$cs_html .= '<div class="cs-rooms-prices cs-customer-area cs-hotels-edit"><div id="cs_customer_pop_'.$counter.'" style="display: none;"><div id="cs_customer_edit">							<div class="cs-popup-header">								<h5 style="margin:0px">' . __('Edit Customer', 'booking') . '</h5>								<span class="cs-pop-close" onclick="javascript:cs_remove_overlay(\'cs_customer_pop_'.$counter.'\',\'append\')"> <i class="icon-times"></i></span>							</div>							<div class="cs-popup-content">';								$cs_html .= '								<div class="hotel-input">								<label>									<span>'.__('First Name','booking').'</span>									<input id="cs_customer_first_name" value="'.$params['cs_cstmr_fname'].'" name="cs_cstmr_fname[]" type="text" />								</label>								<label>									<span>'.__('Last Name','booking').'</span>									<input id="cs_customer_last_name" value="'.$params['cs_cstmr_lname'].'" name="cs_cstmr_lname[]" type="text" />								</label>								</div>								<div class="hotel-input">									<label>										<span>'.__('Username','booking').'</span>';											$cs_users = get_users('orderby=nicename');											$cs_html .=  '											<select name="cs_cstmr_name[]" id="cs_customer_name">												<option value="">None</option>';												foreach ($cs_users as $user) {													if( $user->ID == $params['cs_cstmr_name'] ) {														$selected = ' selected="selected"';													} else { 														$selected = '';													}													$cs_html .=  '<option value="'.$user->ID.'"'.$selected.'>'.$user->display_name.'</option>';												}											$cs_html .= '											</select>';										$cs_html .= '									</label>									<label>										<span>'.__('Email','booking').'</span>										<input id="cs_customer_email" value="'.$params['cs_cstmr_email'].'" name="cs_cstmr_email[]" type="text" />									</label>																	</div>								<div class="hotel-input">									<label>										<span>'.__('Telephone','booking').'</span>										<input id="cs_customer_phone" value="'.$params['cs_cstmr_phone'].'" name="cs_cstmr_phone[]" type="text" />									</label>									<label>										<span>'.__('City','booking').'</span>										<input id="cs_customer_city" value="'.$params['cs_cstmr_city'].'" name="cs_cstmr_city[]" type="text" />									</label>																	</div>								<div class="hotel-input">									<label>										<span>'.__('Country','booking').'</span>										<input id="cs_customer_country" value="'.$params['cs_cstmr_county'].'" name="cs_cstmr_county[]" type="text" />									</label>								</div>								<div class="form-textarea">									<span>'.__('Address','booking').'</span>									<textarea id="cs_customer_address" name="cs_cstmr_adres[]">'.$params['cs_cstmr_adres'].'</textarea>								</div>								<div id="add_customer_to_btn">									 <input type="hidden" name="cs_cstmr_id[]" value="'.$params['cs_cstmr_id'].'" />									<a class="customer-action-btn price-btn" id="cs_edit_customer" data-key="update" data-id="cs_customer_pop_'.$counter.'" type="button">'.__('Update Customer', 'booking').'</a>								</div>							</div>							</div>						</div>';			return force_balance_tags( $cs_html, true );		}				/**		 *		 *@Customer Show		 *		 */		public function customer_val_show( $val = '' ) {						if( $val <> '' ) {				$cs_html = '<small class="customer_val">'.$val.'</small>';			}			else{				$cs_html = '<small class="customer_val"> - </small>';			}			return $cs_html;		}				/**		 *		 *@add New Transaction		 *		 */		public function cs_add_customer_form(){			global $post, $cs_form_fields, $gateways, $cs_plugin_options;			$cs_html  = '';									$cs_html .= '<div class="cs-rooms-prices cs-hotels-area cs-hotels-edit"><div id="cs_customer_pop" style="display: none;">							<div class="cs-popup-header">								<h5 style="margin:0px">' . __('Add Customer', 'booking') . '</h5>								<span class="cs-pop-close" onclick="javascript:cs_remove_overlay(\'cs_customer_pop\',\'append\')"> <i class="icon-times"></i></span>							</div>							<div class="cs-popup-content">							 <div class="message-wrap" style="display:none">								<div class="cs-message updated"></div>							</div>';								$cs_html .= '								<div class="hotel-input">								<label>									<span>'.__('First Name','booking').'</span>									<input id="cs_add_customer_first_name" value="" name="cs_add_customer_first_name" type="text" />								</label>								<label>									<span>'.__('Last Name','booking').'</span>									<input id="cs_add_customer_last_name" value="" name="cs_add_customer_last_name" type="text" />								</label>								</div>								<div class="hotel-input">									<label>										<span>'.__('Username','booking').'</span>';											$cs_users = get_users('orderby=nicename');											$cs_html .=  '											<select name="cs_add_cstmr_name" id="cs_add_cstmr_name">												<option value="">None</option>';												foreach ($cs_users as $user) {													$cs_html .=  '<option value="'.$user->ID.'">'.$user->display_name.'</option>';												}											$cs_html .= '											</select>';										$cs_html .= '									</label>									<label>										<span>'.__('Email','booking').'</span>										<input id="cs_add_customer_email" value="" name="cs_add_customer_email" type="text" />									</label>																	</div>								<div class="hotel-input">									<label>										<span>'.__('Telephone','booking').'</span>										<input id="cs_add_customer_phone" value="" name="cs_add_customer_phone" type="text" />									</label>									<label>										<span>'.__('City','booking').'</span>										<input id="cs_add_customer_city" value="" name="cs_add_customer_city" type="text" />									</label>																	</div>								<div class="hotel-input">									<label>										<span>'.__('Country','booking').'</span>										<input id="cs_add_customer_country" value="" name="cs_add_customer_country" type="text" />									</label>								</div>								<div class="form-textarea">									<span>'.__('Address','booking').'</span>									<textarea id="cs_add_customer_address" name="cs_add_customer_address"></textarea>								</div>								<div class="input-sec">									<a class="customer-action-btn price-btn" id="cs_add_customer" type="button">Add Customer</a>								</div>							</div>							</div>						</div>';				echo force_balance_tags( $cs_html, true );		}						/**		 *		 *@add New Transaction		 *		 */		public function cs_add_customer(){			global $post,$gateways,$cs_plugin_options;						$customer_id			= CS_FUNCTIONS()->cs_generate_random_string(10);			$json					= array();			$cs_customer_email		= $_REQUEST['cs_customer_email'];			$cs_customer_first_name	= $_REQUEST['cs_customer_first_name'];			$cs_customer_last_name	= $_REQUEST['cs_customer_last_name'];			$cs_customer_address	= $_REQUEST['cs_customer_address'];			$cs_customer_name		= $_REQUEST['cs_customer_name'];			$cs_customer_phone		= $_REQUEST['cs_customer_phone'];			$cs_customer_city		= $_REQUEST['cs_customer_city'];			$cs_customer_country	= $_REQUEST['cs_customer_country'];					if( $customer_id !='' 				&& $cs_customer_email 		!='' 				&& $cs_customer_first_name 	!='' 				&& $cs_customer_last_name 	!='' 				&& $cs_customer_address 	!='' 				&& $cs_customer_phone 		!='' 				&& $cs_customer_city 		!=''				&& $cs_customer_country !='' ){										$cs_new_customer	= array();					$user_data = get_user_by( 'id', $cs_customer_name );					$user_name = (isset($user_data) and $user_data <> '') ? $user_data->display_name : '';										$cs_customer	= get_option('cs_customer_options');										if( isset( $cs_customer ) && ! is_array( $cs_customer ) ) {						$cs_customer	= array();					}										if( isset( $cs_customer[$customer_id]) ) {						$json['type']		= 'error';						$json['message']	= __('Customer Id already exist.','booking');						echo json_encode( $json );						die();					} else {												$cs_new_customer[$customer_id]['cus_id']		= $customer_id;							$cs_new_customer[$customer_id]['cus_name']		= $cs_customer_name;							$cs_new_customer[$customer_id]['cus_f_name']	= $cs_customer_first_name;							$cs_new_customer[$customer_id]['cus_l_name']	= $cs_customer_last_name;							$cs_new_customer[$customer_id]['cus_email']		= $cs_customer_email;							$cs_new_customer[$customer_id]['cus_phone_no']	= $cs_customer_phone;							$cs_new_customer[$customer_id]['cus_address']	= $cs_customer_address;							$cs_new_customer[$customer_id]['cus_city']		= $cs_customer_city;							$cs_new_customer[$customer_id]['cus_country']	= $cs_customer_country;												$params	= array();						$params['cs_cstmr_id'] 	   = $customer_id;						$params['cs_cstmr_name']   = $cs_customer_name;						$params['cs_cstmr_fname']  = $cs_customer_first_name;						$params['cs_cstmr_lname']  = $cs_customer_last_name;						$params['cs_cstmr_phone']  = $cs_customer_phone;						$params['cs_cstmr_email']  = $cs_customer_email;						$params['cs_cstmr_adres']  = $cs_customer_address;						$params['cs_cstmr_city']   = $cs_customer_city;						$params['cs_cstmr_county'] = $cs_customer_country;																			$cs_all_customer	= 	array_merge($cs_customer,$cs_new_customer);												$json['data']	= '<tr>';							$json['data']	.= '<td class="cs_customer_first_name">'.$cs_customer_first_name.'</td>';							$json['data']	.= '<td class="cs_customer_last_name">'.$cs_customer_last_name.'</td>';							$json['data']	.= '<td class="cs_customer_name">'.$user_name.'</td>';							$json['data']	.= '<td class="cs_customer_phone">'.$cs_customer_phone.'</td>';							$json['data']	.= '<td class="cs_customer_email">'.$cs_customer_email.'</td>';							$json['data']	.= '<td class="cs_customer_address">'.$cs_customer_address.'</td>';							$json['data']	.= '<td class="cs_customer_city">'.$cs_customer_city.'</td>';							$json['data']	.= '<td class="cs_customer_country">'.$cs_customer_country.'</td>';							$json['data']	.= '<td>													<a class="remove-custmr" href="javascript:;" title="delete"><i class="icon-trash4"></i></a>													<a href="javascript:cs_createpop(\'cs_customer_pop_'.$customer_id.'\',\'filter\')"><i class="icon-pencil3"></i></a>													'.$this->cs_customer_edit($customer_id,$params).'																									</td>';						$json['data']	.= '</tr>';												update_option( 'cs_customer_options',$cs_all_customer );						$json['type']		= 'success';						$json['message']	= __('Customer Added.','booking');					}				} else{				$json['type']		= 'error';				$json['message']	= __('Please fill all the fields.','booking');			}						echo json_encode( $json );			die();		}		// Update Customers		public function cs_update_customers(){						$exs_data = get_option( "cs_customer_options" );						$customers_counter = 0;			$customers_array = $customers = $customerdata = array();			if ( isset( $_POST['cs_cstmr_id'] ) && sizeof( $_POST['cs_cstmr_id'] ) > 0 ) {								foreach($_POST['cs_cstmr_id'] as $keys=>$values){					if($values){														$customers_array['cus_id']		= isset($_POST['cs_cstmr_id'][$customers_counter]) ? $_POST['cs_cstmr_id'][$customers_counter] : '';						$customers_array['cus_name']	= isset($_POST['cs_cstmr_name'][$customers_counter]) ? $_POST['cs_cstmr_name'][$customers_counter] : '';						$customers_array['cus_f_name']	= isset($_POST['cs_cstmr_fname'][$customers_counter]) ? $_POST['cs_cstmr_fname'][$customers_counter] : '';						$customers_array['cus_l_name']	= isset($_POST['cs_cstmr_lname'][$customers_counter]) ? $_POST['cs_cstmr_lname'][$customers_counter] : '';						$customers_array['cus_phone_no']= isset($_POST['cs_cstmr_phone'][$customers_counter]) ? $_POST['cs_cstmr_phone'][$customers_counter] : '';						$customers_array['cus_email']	= isset($_POST['cs_cstmr_email'][$customers_counter]) ? $_POST['cs_cstmr_email'][$customers_counter] : '';						$customers_array['cus_address']	= isset($_POST['cs_cstmr_adres'][$customers_counter]) ? $_POST['cs_cstmr_adres'][$customers_counter] : '';						$customers_array['cus_city']	= isset($_POST['cs_cstmr_city'][$customers_counter]) ? $_POST['cs_cstmr_city'][$customers_counter] : '';						$customers_array['cus_country']	= isset($_POST['cs_cstmr_county'][$customers_counter]) ? $_POST['cs_cstmr_county'][$customers_counter] : '';						$customers[$values] = $customers_array;						$customers_counter++;					}				}												update_option( "cs_customer_options", $customers );			}		}				public function customer_fields_save() {						$this->cs_update_customers();			echo __("All Customer Saved", "booking");						die();		}			}}if( class_exists('cs_customers_options') ) {	$cs_customers_obj = new cs_customers_options();	add_action( 'admin_menu', array(&$cs_customers_obj, 'cs_customers_settings') );}